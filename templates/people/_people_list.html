{% load extras %}

{# Desktop: Table-like Layout with Header #}
<div class="hidden lg:block">
  <div class="card p-0 overflow-hidden">
    <div class="grid grid-cols-[2fr_1.5fr_1.2fr_0.8fr_0.7fr] gap-4 px-4 py-3 border-b border-slate-200 bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-600">
      <div>Pessoa</div>
      <div>Papeis / Experiencia</div>
      <div>Qualificacoes</div>
      <div>Confiabilidade</div>
      <div>Frequencia</div>
    </div>

    {% for member in members %}
      <a href="{{ member.detail_url }}" class="grid grid-cols-[2fr_1.5fr_1.2fr_0.8fr_0.7fr] gap-4 px-4 py-3 items-center border-b border-slate-100 hover:bg-slate-50 hover:translate-x-1 transition-all duration-200 w-full block">
        {# Person Cell #}
        <div class="flex items-center gap-3 min-w-0">
          <div class="h-9 w-9 rounded-full bg-sand-100 text-ink flex items-center justify-center font-semibold text-xs flex-shrink-0">
            {{ member.name|initials }}
          </div>
          <div class="min-w-0 flex-1">
            <div class="font-medium text-sm text-ink truncate">{{ member.name }}</div>
            <div class="text-xs text-slate truncate">
              {% if member.user %}
                {{ member.user.email|default:"Sem email" }}{% if member.user.phone %} · {{ member.user.phone }}{% endif %}
              {% else %}
                Sem login
              {% endif %}
            </div>
          </div>
        </div>
        
        {# Roles/Experience Cell - All inline #}
        <div class="text-xs text-slate leading-relaxed">
          {% if member.roles %}
            <span class="italic text-slate-600">{% for role in member.roles %}{{ role.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</span>{% if member.acolyte %} · {% endif %}
          {% endif %}
          {% if member.acolyte %}
            {{ member.acolyte.get_experience_level_display }}{% if member.acolyte.scheduling_mode == "reserve" %} · Reserva{% endif %}{% if member.user and not member.user.is_active or member.acolyte and not member.acolyte.active %} · {% endif %}
          {% endif %}
          {% if member.user and not member.user.is_active %}Inativo{% elif member.acolyte and not member.acolyte.active %}Inativo{% endif %}
        </div>
        
        {# Qualifications Cell #}
        <div>
          {% if member.is_all_qualified %}
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800" title="Qualificado para todas as funcoes: {{ member.qualifications|join:', ' }}">Todas ({{ member.qualification_codes|length }})</span>
          {% elif member.qualification_codes %}
            <div class="flex flex-wrap gap-1">
              {% for code in member.qualification_codes %}
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-mono font-medium bg-slate-100 text-slate-700">{{ code }}</span>
              {% endfor %}
            </div>
          {% else %}
            <span class="text-xs text-slate">—</span>
          {% endif %}
        </div>
        
        {# Reliability Cell #}
        <div>
          {% if member.stats and member.stats.reliability_score is not None %}
            <div class="flex items-center gap-2">
              <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden">
                <div class="h-full bg-green-500 transition-all duration-300" style="width: {{ member.stats.reliability_score|floatformat:1 }}%;"></div>
              </div>
              <div class="text-xs font-medium text-slate-700 tabular-nums">{{ member.stats.reliability_score|floatformat:0 }}%</div>
            </div>
          {% else %}
            <div class="text-xs text-slate">n/d</div>
          {% endif %}
        </div>
        
        {# Frequency Cell - Inline #}
        <div class="text-xs text-slate tabular-nums">
          <span>30d: <span class="text-slate-900 font-medium">{{ member.stats.services_last_30_days|default:"0" }}</span></span> · <span>90d: <span class="text-slate-900 font-medium">{{ member.stats.services_last_90_days|default:"0" }}</span></span>
        </div>
      </a>
    {% empty %}
      <div class="p-6 text-sm text-slate text-center">
        Nenhuma pessoa encontrada com os filtros atuais.
      </div>
    {% endfor %}
  </div>
</div>

{# Mobile: Compact Stacked Cards #}
<div class="lg:hidden space-y-3">
  {% for member in members %}
    <a href="{{ member.detail_url }}" class="card block">
      <div class="flex items-center gap-3 mb-3">
        <div class="h-10 w-10 rounded-full bg-sand-100 text-ink flex items-center justify-center font-semibold text-sm flex-shrink-0">
          {{ member.name|initials }}
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-medium truncate">{{ member.name }}</div>
          <div class="text-xs text-slate truncate">
            {% if member.user %}
              {{ member.user.email|default:"Sem email" }}
              {% if member.user.phone %} - {{ member.user.phone }}{% endif %}
            {% else %}
              Sem login
            {% endif %}
          </div>
        </div>
      </div>
      
      <div class="people-mobile-inline mb-2">
        {% if member.roles %}
          {% for role in member.roles %}{{ role.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
        {% else %}
          <span class="text-slate">Sem papel</span>
        {% endif %}
        {% if member.acolyte %}
          <span class="people-mobile-separator">·</span>
          {{ member.acolyte.get_experience_level_display }}
          {% if member.acolyte.scheduling_mode == "reserve" %}
            <span class="people-mobile-separator">·</span>
            Reserva
          {% endif %}
        {% endif %}
      </div>
      
       <div class="mb-2">
         {% if member.is_all_qualified %}
           <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800" title="Qualificado para todas as funcoes: {{ member.qualifications|join:', ' }}">Todas ({{ member.qualification_codes|length }})</span>
         {% elif member.qualification_codes %}
           {% for code in member.qualification_codes %}<span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-mono font-medium bg-slate-100 text-slate-700">{{ code }}</span>{% endfor %}
         {% else %}
           <span class="text-xs text-slate">Sem qualificacoes</span>
         {% endif %}
       </div>
      
       <div class="flex items-center gap-3 text-xs">
         {% if member.stats and member.stats.reliability_score is not None %}
           <div class="flex items-center gap-2">
             <div class="w-16 h-2 bg-slate-200 rounded-full overflow-hidden">
               <div class="h-full bg-green-500 transition-all duration-300" style="width: {{ member.stats.reliability_score|floatformat:1 }}%;"></div>
             </div>
             <span class="font-medium text-slate-700 tabular-nums">{{ member.stats.reliability_score|floatformat:0 }}%</span>
           </div>
         {% else %}
           <span class="text-slate">Conf: n/d</span>
         {% endif %}
         <span class="text-slate">·</span>
         <span class="tabular-nums">30d: {{ member.stats.services_last_30_days|default:"0" }}</span>
         <span class="text-slate">·</span>
         <span class="tabular-nums">90d: {{ member.stats.services_last_90_days|default:"0" }}</span>
       </div>
    </a>
  {% empty %}
    <div class="card text-sm text-slate">Nenhuma pessoa encontrada com os filtros atuais.</div>
  {% endfor %}
</div>
