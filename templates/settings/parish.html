{% extends 'base.html' %}
{% block title %}Configuracoes{% endblock %}
{% block content %}
<div class="grid gap-6">
  <div class="card max-w-3xl">
    <h2 class="font-serif text-xl mb-2">Configuracoes da paroquia</h2>
    <p class="text-sm text-slate">Ajuste janelas de consolidacao, pesos e regras operacionais.</p>
  </div>

  <form method="post" class="card max-w-3xl space-y-6">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label class="label">Consolidacao (dias)</label>
        {{ form.consolidation_days }}
        <p class="text-xs text-slate mt-1">Ate quantos dias no futuro os acolitos podem confirmar presenca (7-90).</p>
      </div>
      <div>
        <label class="label">Horizonte (dias)</label>
        {{ form.horizon_days }}
        {% if form.horizon_days.errors %}
          <p class="text-xs text-red-600 mt-1">{{ form.horizon_days.errors|join:", " }}</p>
        {% endif %}
        <p class="text-xs text-slate mt-1">Intervalo maximo para gerar escalas futuras.</p>
      </div>
      <div>
        <label class="label">Duracao padrao da missa (min)</label>
        {{ form.default_mass_duration_minutes }}
      </div>
      <div>
        <label class="label">Descanso minimo entre missas (min)</label>
        {{ form.min_rest_minutes_between_masses }}
      </div>
    </div>

    <div class="check-grid">
      <label class="check-item">
        {{ form.swap_requires_approval }}
        <span class="text-sm">Exigir aprovacao da coordenacao para trocas</span>
      </label>
      <label class="check-item">
        {{ form.claim_require_coordination }}
        <span class="text-sm">Exigir aprovacao da coordenacao para transferencias</span>
      </label>
      <label class="check-item">
        {{ form.notify_on_cancellation }}
        <span class="text-sm">Notificar coordenacao em cancelamentos</span>
      </label>
      <label class="check-item">
        {{ form.auto_assign_on_decline }}
        <span class="text-sm">Auto atribuir substituto ao recusar</span>
      </label>
      <label class="check-item">
        {{ form.claim_auto_approve_enabled }}
        <span class="text-sm">Auto aprovar solicitacoes sem resposta</span>
      </label>
    </div>

    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label class="label">Auto aprovar antes da missa (horas)</label>
        {{ form.claim_auto_approve_hours }}
        <p class="text-xs text-slate mt-1">Se o titular nao confirmar ate este prazo.</p>
      </div>
    </div>

    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label class="label">Penalidade de estabilidade</label>
        {{ form.stability_penalty }}
      </div>
      <div>
        <label class="label">Penalidade de fairness</label>
        {{ form.fairness_penalty }}
      </div>
      <div>
        <label class="label">Peso de credito</label>
        {{ form.credit_weight }}
      </div>
      <div>
        <label class="label">Penalidade reserva tecnica</label>
        {{ form.reserve_penalty }}
        <p class="text-xs text-slate mt-1">Usado para acolitos marcados como reserva.</p>
      </div>
      <div>
        <label class="label">Tempo maximo do solver (s)</label>
        {{ form.max_solve_seconds }}
      </div>
      <div>
        <label class="label">Maximo por semana</label>
        {{ form.max_services_per_week }}
      </div>
      <div>
        <label class="label">Maximo fins de semana seguidos</label>
        {{ form.max_consecutive_weekends }}
      </div>
      <div>
        <label class="label">Penalidade de rotacao</label>
        {{ form.rotation_penalty }}
      </div>
      <div>
        <label class="label">Janela de rotacao (dias)</label>
        {{ form.rotation_days }}
      </div>
      <div>
        <label class="label">Bonus comunidade de origem</label>
        {{ form.home_community_bonus }}
      </div>
      <div>
        <label class="label">Penalidade comunidade recente</label>
        {{ form.community_recent_penalty }}
      </div>
      <div>
        <label class="label">Janela comunidade recente (dias)</label>
        {{ form.community_recent_window_days }}
      </div>
      <div>
        <label class="label">Bonus de escassez</label>
        {{ form.scarcity_bonus }}
      </div>
      <div>
        <label class="label">Fator comunidade em eventos</label>
        {{ form.event_series_community_factor }}
      </div>
      <div>
        <label class="label">Politica para missa avulsa</label>
        {{ form.single_mass_community_policy }}
      </div>
      <div>
        <label class="label">Prazo de interesse (horas)</label>
        {{ form.interest_deadline_hours }}
      </div>
      <div>
        <label class="label">Fallback pool interessados</label>
        {{ form.interested_pool_fallback }}
      </div>
    </div>

    <details class="border border-black/5 rounded-xl p-4">
      <summary class="cursor-pointer font-medium">Avancado: JSON de pesos</summary>
      <div class="mt-3">
        <label class="label">schedule_weights</label>
        {{ form.schedule_weights_json }}
        {% if form.schedule_weights_json.errors %}
          <p class="text-xs text-red-600 mt-1">{{ form.schedule_weights_json.errors|join:", " }}</p>
        {% endif %}
        <p class="text-xs text-slate mt-1">Use apenas se precisar ajustar pesos nao listados acima.</p>
      </div>
    </details>

    <div class="flex items-center gap-3">
      <button class="btn-primary" type="submit">Salvar configuracoes</button>
      <button class="btn-secondary" type="submit" name="action" value="reset">Restaurar padroes</button>
      <a class="btn-secondary" href="{% url 'dashboard' %}">Voltar</a>
    </div>
  </form>
</div>
{% endblock %}
