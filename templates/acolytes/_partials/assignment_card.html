{% load extras %}
<div class="border border-sand-200 rounded-lg p-4 hover:border-sand-300 transition-colors" id="assignment-{{ assignment.id }}">
  <div class="flex items-start justify-between gap-4">
    <!-- Info principal -->
    <div class="flex-1 min-w-0">
      <div class="flex items-baseline gap-2 mb-1">
        <time class="text-ink font-medium">{{ assignment.slot.mass_instance.starts_at|date:"H:i" }}</time>
        <span class="text-ink-400">•</span>
        <span class="text-ink-600 text-sm">{{ assignment.slot.mass_instance.community.code }}</span>
        <span class="text-ink-400">•</span>
        <span class="text-ink-500 text-sm">{{ assignment.slot.mass_instance.starts_at|date:"d/m/Y" }}</span>
      </div>
      
      <div class="text-sm text-ink-700 mb-1">{{ assignment.slot.position_type.name }}</div>
      
      {% with team=team_names_map|get_item:assignment.slot.mass_instance_id %}
        {% if team %}
          <div class="text-xs text-ink-400">{{ team }}</div>
        {% endif %}
      {% endwith %}
    </div>
    
    <!-- Status e Ações -->
    <div class="flex flex-col items-end gap-2 flex-shrink-0">
      {# Status #}
      {% if assignment.confirmation %}
        {% if assignment.confirmation.status == "confirmed" %}
          <span class="text-xs text-moss-600">Confirmada</span>
        {% elif assignment.confirmation.status == "pending" %}
          <span class="text-xs text-amber-600">Aguardando confirmacao</span>
        {% endif %}
      {% else %}
        <span class="text-xs text-ink-400">Proposta</span>
      {% endif %}
      
      {# Buttons #}
      <div class="flex flex-wrap items-center gap-2">
        {# Confirmar - mostrar se não confirmado ainda #}
        {% if not assignment.confirmation or assignment.confirmation.status != "confirmed" %}
          <button
            hx-post="{% url 'confirm_assignment' assignment.id %}"
            hx-target="#assignment-{{ assignment.id }}"
            hx-swap="outerHTML"
            class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-[#0f5e4d] bg-[#0f5e4d]/10 hover:bg-[#0f5e4d]/20 border border-[#0f5e4d]/30 rounded-lg transition-colors"
            type="button">
            Confirmar
          </button>
        {% endif %}
        
        {# Trocar função - se missa tem múltiplos slots e não há troca pendente #}
        {% with has_multiple=mass_has_multiple_slots|get_item:assignment.slot.mass_instance_id %}
          {% with has_pending_swap=pending_swaps_by_slot|get_item:assignment.slot_id %}
            {% if has_pending_swap %}
              <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded-lg">
                Troca pendente
              </span>
            {% elif has_multiple %}
              <a
                href="{% url 'swap_request_create' assignment.id %}"
                class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-ink-600 bg-sand-50 hover:bg-sand-100 border border-sand-200 rounded-lg transition-colors">
                Trocar funcao
              </a>
            {% endif %}
          {% endwith %}
        {% endwith %}
        
        {# Rejeitar #}
        <button
          hx-post="{% url 'decline_assignment' assignment.id %}"
          hx-target="#assignment-{{ assignment.id }}"
          hx-swap="outerHTML"
          hx-confirm="Tem certeza que deseja rejeitar esta escala?"
          class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-red-500 bg-red-50 hover:bg-red-100 border border-red-200 rounded-lg transition-colors"
          type="button">
          Rejeitar
        </button>
      </div>
    </div>
  </div>
</div>
