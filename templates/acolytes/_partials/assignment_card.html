{% load extras %}
<div class="border border-black/8 rounded-xl p-5 hover:bg-sand/20 hover:border-moss/20 transition-all duration-200 hover:shadow-sm group" id="assignment-{{ assignment.id }}">
  <div class="flex flex-wrap items-start justify-between gap-4">
    <div class="flex items-start gap-4">
      <div class="w-12 h-12 bg-slate rounded-full flex items-center justify-center text-white font-serif text-sm font-bold flex-shrink-0">
        {{ assignment.slot.mass_instance.community.code|slice:":1" }}
      </div>
      <div>
        <div class="text-sm text-slate font-medium mb-1">{{ assignment.slot.mass_instance.starts_at|date:"l, d/m/Y" }}</div>
        <div class="font-semibold text-lg text-ink group-hover:text-moss transition-colors">{{ assignment.slot.mass_instance.starts_at|date:"H:i" }} â€¢ {{ assignment.slot.mass_instance.community.code }}</div>
        <div class="text-slate font-medium">{{ assignment.slot.position_type.name }}</div>
        {% with team=team_names_map|get_item:assignment.slot.mass_instance_id %}
          {% if team %}
            <div class="text-xs text-slate mt-2 bg-sand/50 rounded-lg px-2 py-1 inline-block">Equipe: {{ team }}</div>
          {% endif %}
        {% endwith %}
      </div>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      {% if assignment.confirmation %}
      <span class="badge">{{ assignment.confirmation.status|confirmation_status_label }}</span>
        {% if assignment.confirmation.status == "pending" %}
          <div class="flex gap-2">
            <button 
              hx-post="{% url 'confirm_assignment' assignment.id %}"
              hx-target="#assignment-{{ assignment.id }}"
              hx-swap="outerHTML"
              class="btn-primary text-sm px-4 py-2" 
              type="button">
              Confirmar
            </button>
            <button 
              hx-post="{% url 'decline_assignment' assignment.id %}"
              hx-target="#assignment-{{ assignment.id }}"
              hx-swap="outerHTML"
              hx-confirm="Tem certeza que deseja recusar esta escala?"
              class="btn-secondary text-sm px-4 py-2" 
              type="button">
              Recusar
            </button>
          </div>
        {% elif assignment.confirmation.status == "confirmed" %}
          <button 
            hx-post="{% url 'cancel_assignment' assignment.id %}"
            hx-target="#assignment-{{ assignment.id }}"
            hx-swap="outerHTML"
            hx-confirm="Tem certeza que deseja cancelar esta escala?"
            class="btn-secondary text-sm px-4 py-2" 
            type="button">
            Cancelar
          </button>
        {% endif %}
        <a class="btn-secondary text-sm px-4 py-2" href="{% url 'swap_request_create' assignment.id %}">Solicitar troca</a>
      {% else %}
      <span class="badge">{{ assignment.assignment_state|assignment_state_label }}</span>
        <a class="btn-secondary text-sm px-4 py-2" href="{% url 'swap_request_create' assignment.id %}">Solicitar troca</a>
      {% endif %}
    </div>
  </div>
</div>
