{% load extras %}
<div class="bg-white border border-sand-200 rounded-lg p-4 hover:border-sand-300 transition-colors" id="claim-{{ claim.id }}">
  <div class="flex items-start justify-between gap-4">
    <div class="flex-1 min-w-0">
      <div class="text-sm text-ink-600 mb-2">
        {{ claim.slot.mass_instance.starts_at|date:"H:i" }} · {{ claim.slot.mass_instance.community.code }} · {{ claim.slot.mass_instance.starts_at|date:"d/m/Y" }}
      </div>
      <div class="text-base font-medium text-ink">{{ claim.slot.position_type.name }}</div>
      <div class="text-sm text-slate mt-1">Solicitante: {{ claim.requestor_acolyte.display_name }}</div>
      {% if claim.target_assignment %}
        <div class="text-sm text-slate">Titular: {{ claim.target_assignment.acolyte.display_name }}</div>
      {% endif %}
      {% if claim.status == "scheduled_auto_approve" and claim.auto_approve_at %}
        <div class="text-xs text-slate mt-2">Auto aprova {{ claim.auto_approve_at|date:"d/m H:i" }}</div>
      {% endif %}
      {% if claim.resolution_reason %}
        <div class="text-xs text-slate mt-2">
          {{ claim_reason_labels|get_item:claim.resolution_reason|default:claim.resolution_reason }}
        </div>
      {% endif %}
      {% if claim.approved_by %}
        <div class="text-xs text-slate">Aprovado por {{ claim.approved_by.full_name|default:claim.approved_by.email }}</div>
      {% endif %}
    </div>
    <span class="badge badge-gray">{{ claim_status_labels|get_item:claim.status|default:claim.status }}</span>
  </div>

  {% if claim.status == "pending_coordination" and can_manage_parish %}
    <div class="flex flex-wrap items-center gap-2 pt-3 border-t border-sand-100">
      <button
        hx-post="{% url 'position_claim_approve' claim.id %}"
        hx-target="#claim-{{ claim.id }}"
        hx-swap="outerHTML"
        hx-vals='{"return": "claim_card"}'
        class="btn-primary btn-compact"
        type="button">
        Aprovar
      </button>
      <button
        hx-post="{% url 'position_claim_reject' claim.id %}"
        hx-target="#claim-{{ claim.id }}"
        hx-swap="outerHTML"
        hx-vals='{"return": "claim_card"}'
        class="btn-secondary btn-compact"
        type="button">
        Recusar
      </button>
    </div>
  {% endif %}

  {% if claim.status == "pending_target" or claim.status == "scheduled_auto_approve" %}
    {% if claim.target_assignment and claim.target_assignment.acolyte.user_id == request.user.id %}
      <div class="flex flex-wrap items-center gap-2 pt-3 border-t border-sand-100">
        <button
          hx-post="{% url 'position_claim_choose' claim.id %}"
          hx-target="#claim-{{ claim.id }}"
          hx-swap="outerHTML"
          hx-vals='{"return": "claim_card"}'
          class="btn-secondary btn-compact"
          type="button">
          Ceder
        </button>
        <button
          hx-post="{% url 'position_claim_reject' claim.id %}"
          hx-target="#claim-{{ claim.id }}"
          hx-swap="outerHTML"
          hx-vals='{"return": "claim_card"}'
          class="btn-secondary btn-compact"
          type="button">
          Recusar
        </button>
      </div>
    {% endif %}

    {% if claim.requestor_acolyte.user_id == request.user.id %}
      <div class="flex flex-wrap items-center gap-2 pt-3 border-t border-sand-100">
        <button
          hx-post="{% url 'position_claim_cancel' claim.id %}"
          hx-target="#claim-{{ claim.id }}"
          hx-swap="outerHTML"
          hx-vals='{"return": "claim_card"}'
          class="btn-secondary btn-compact"
          type="button">
          Cancelar
        </button>
      </div>
    {% endif %}
  {% endif %}
</div>
