{% load extras %}
{% if hero_assignment %}
  <div id="assignment-{{ hero_assignment.id }}" class="rounded-2xl bg-gradient-to-br from-sand-50 via-white to-moss-50/40 p-6 sm:p-8 shadow-soft border border-white/70">
    <div class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
      <div class="space-y-3">
        <div class="text-xs uppercase tracking-[0.2em] text-slate">Sua proxima escala</div>
        <div class="text-2xl sm:text-3xl font-serif text-ink">{{ hero_assignment.slot.mass_instance.starts_at|date:"l, d M" }}</div>
        <div class="text-5xl sm:text-6xl font-serif text-ink">{{ hero_assignment.slot.mass_instance.starts_at|date:"H:i" }}</div>
        <div class="text-base text-slate">{{ hero_assignment.slot.mass_instance.community.code }}</div>
        <div class="inline-flex items-center px-3 py-1 rounded-full bg-white/80 border border-moss-200 text-sm font-medium text-moss">
          {{ hero_assignment.slot.position_type.name }}
        </div>
      </div>
      <div class="flex w-full flex-col gap-4 md:w-auto md:min-w-[280px]">
        {% with claims=claims_by_slot|get_item:hero_assignment.slot_id %}
          {% if claims %}
            <div class="rounded-lg bg-white/70 px-3 py-3">
              <div class="text-[11px] uppercase tracking-[0.2em] text-slate">Solicitacoes de posicao</div>
              <div class="mt-2 space-y-2">
                {% for claim in claims %}
                  <div class="flex items-center justify-between gap-3">
                    <span class="text-sm text-ink">{{ claim.requestor_acolyte.display_name }}</span>
                    <button
                      hx-post="{% url 'position_claim_choose' claim.id %}"
                      hx-target="#assignment-{{ hero_assignment.id }}"
                      hx-swap="outerHTML"
                      hx-vals='{"return": "dashboard_hero"}'
                      class="btn-secondary btn-compact"
                      type="button">
                      Ceder
                    </button>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endwith %}

        {% if hero_assignment.confirmation.status == 'confirmed' %}
          <div class="inline-flex items-center justify-center rounded-full bg-moss-100 px-3 py-1 text-sm font-medium text-moss">
            Confirmado
          </div>
          <a href="{% url 'swap_request_create' hero_assignment.id %}" class="btn-secondary w-full md:w-auto text-center">Solicitar troca</a>
        {% else %}
          <button
            hx-post="{% url 'confirm_assignment' hero_assignment.id %}"
            hx-target="#assignment-{{ hero_assignment.id }}"
            hx-swap="outerHTML"
            hx-vals='{"return": "dashboard_hero"}'
            class="btn-primary w-full md:w-auto"
            type="button">
            Confirmar presenca
          </button>
        {% endif %}
      </div>
    </div>
  </div>
{% endif %}
