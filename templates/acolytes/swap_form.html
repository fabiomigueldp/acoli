{% extends 'base.html' %}
{% block title %}Trocar função{% endblock %}
{% block content %}
<div class="max-w-lg">
  {% url 'my_assignments' as fallback_url %}
   <div class="mb-6">
     <a href="{{ back_url|default:fallback_url }}" class="text-sm text-ink-500 hover:text-ink-700">&larr; Voltar</a>
   </div>
  
  <div class="card">
    <h2 class="font-serif text-xl mb-2">Trocar função</h2>
    
    <div class="text-sm text-ink-600 mb-6">
      <div class="mb-1">
        <span class="text-ink-400">Missa:</span>
        {{ mass_instance.starts_at|date:"d/m/Y" }} às {{ mass_instance.starts_at|date:"H:i" }} • {{ mass_instance.community.code }}
      </div>
      <div>
        <span class="text-ink-400">Sua função atual:</span>
        {{ assignment.slot.position_type.name }}
      </div>
    </div>
    
    {% if swap_options %}
    <form method="post">
      {% csrf_token %}
      
      <div class="mb-4">
        <label class="label mb-2">Selecione as funções que aceita trocar</label>
        <p class="text-xs text-ink-400 mb-3">Você pode selecionar múltiplas opções. Os acólitos selecionados serão notificados e quem aceitar primeiro concretiza a troca.</p>
        <div class="space-y-2">
          {% for option in swap_options %}
          <label class="flex items-center gap-3 p-3 border border-sand-200 rounded-lg cursor-pointer hover:border-sand-300 has-[:checked]:border-[#0f5e4d] has-[:checked]:bg-[#0f5e4d]/5 transition-colors">
            <input type="checkbox" name="target_slots" value="{{ option.slot.id }}" class="w-4 h-4 text-[#0f5e4d] rounded border-sand-300 focus:ring-[#0f5e4d]">
            <div class="flex-1">
              <div class="text-ink-700 font-medium">{{ option.position_name }}</div>
              <div class="text-sm text-ink-500">{{ option.acolyte.display_name }}</div>
            </div>
          </label>
          {% endfor %}
        </div>
      </div>
      
      <div class="mb-6">
        <label class="label">Motivo (opcional)</label>
        <input type="text" name="notes" class="input w-full" placeholder="Ex: prefiro esta função...">
      </div>
      
      <div class="flex gap-3">
        <button type="submit" class="btn-primary">Solicitar troca</button>
        <a href="{{ back_url|default:fallback_url }}" class="btn-secondary">Cancelar</a>
      </div>
    </form>
    {% else %}
    <p class="text-ink-500 py-4">Não há outras funções disponíveis para troca nesta missa.</p>
    <a href="{{ back_url|default:fallback_url }}" class="btn-secondary inline-block">Voltar</a>
    {% endif %}
  </div>
</div>
{% endblock %}
