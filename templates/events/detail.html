{% extends 'base.html' %}
{% block title %}Celebracao{% endblock %}
{% block content %}
<div class="space-y-6">
  <div class="card">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h2 class="font-serif text-xl">{{ series.title }}</h2>
        <div class="text-sm text-slate">
          {{ series.series_type }} · {{ series.start_date }} a {{ series.end_date }}
        </div>
        <div class="mt-2 flex items-center gap-2">
          <span class="badge">{% if series.is_active %}Ativa{% else %}Arquivada{% endif %}</span>
          {% if series.candidate_pool == "interested_only" %}
            <span class="badge">Somente interessados</span>
          {% endif %}
        </div>
        <div class="text-xs text-slate mt-2 space-y-1">
          <div>Pool: {% if series.candidate_pool == "interested_only" %}Somente interessados{% else %}Todos os acolitos{% endif %}</div>
          <div>Comunidade padrao: {{ series.default_community|default:"-" }}</div>
          <div>Horario padrao: {{ default_time|default:"-" }}</div>
          <div>Perfil padrao: {{ default_profile|default:"-" }}</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <a class="btn-secondary" href="{% url 'event_series_edit' series.id %}">Editar serie</a>
        <a class="btn-secondary" href="{% url 'event_series_occurrences' series.id %}">Editar dias</a>
        {% if series.is_active %}
          <form method="post" action="{% url 'event_series_archive' series.id %}" onsubmit="return confirm('Arquivar esta serie? As missas geradas permanecem no historico.');">
            {% csrf_token %}
            <button class="btn-secondary" type="submit">Arquivar</button>
          </form>
        {% else %}
          <form method="post" action="{% url 'event_series_unarchive' series.id %}">
            {% csrf_token %}
            <button class="btn-secondary" type="submit">Reativar</button>
          </form>
          <form method="post" action="{% url 'event_series_delete' series.id %}" onsubmit="return confirm('Excluir esta serie e todas as missas geradas? Esta acao e irreversivel.');">
            {% csrf_token %}
            <button class="btn-secondary" type="submit">Excluir</button>
          </form>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="card">
    <h3 class="font-serif text-lg mb-3">Ocorrencias</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-slate">
            <th class="py-2 pr-4">Data</th>
            <th class="py-2 pr-4">Horario</th>
            <th class="py-2 pr-4">Comunidade</th>
            <th class="py-2 pr-4">Perfil</th>
            <th class="py-2 pr-4">Rotulo</th>
            <th class="py-2">Conflito</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-black/5">
          {% for occ in occurrences %}
            <tr>
              <td class="py-2 pr-4">{{ occ.date }}</td>
              <td class="py-2 pr-4">{{ occ.time }}</td>
              <td class="py-2 pr-4">{{ occ.community.code }}</td>
              <td class="py-2 pr-4">{{ occ.requirement_profile|default:"-" }}</td>
              <td class="py-2 pr-4">{{ occ.label|default:"-" }}</td>
              <td class="py-2">{{ occ.get_conflict_action_display }}</td>
            </tr>
          {% empty %}
            <tr><td class="py-2 text-slate" colspan="6">Nenhuma ocorrencia registrada.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3 class="font-serif text-lg mb-3">Missas geradas</h3>
    <div class="space-y-2">
      {% for mass in masses %}
        <a class="block border border-black/5 rounded-lg p-3 hover:border-black/10" href="{% url 'mass_detail' mass.id %}">
          <div class="font-medium">{{ mass.starts_at|date:"d/m/Y H:i" }} · {{ mass.community.code }}</div>
          <div class="text-xs text-slate">{{ mass.liturgy_label|default:"-" }}{% if mass.status == "canceled" %} · Cancelada{% endif %}</div>
        </a>
      {% empty %}
        <p class="text-sm text-slate">Nenhuma missa gerada.</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
